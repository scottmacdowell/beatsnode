// Generated by CoffeeScript 1.6.3
var args, count, deps, detective, fin, fs, _;

_ = require('lodash');

fs = require('fs');

detective = require('detective');

args = process.argv.slice(2);

count = args.length;

deps = [];

args.forEach(function(arg, n) {
  return fs.exists(arg, function(exists) {
    if (!exists) {
      throw new Error("file/dir " + arg + " doesn't exist!");
    }
    return fs.readFile("" + __dirname + "/" + arg, function(err, content) {
      if (err) {
        throw new Error(err);
      }
      deps.push((detective(content)).filter(function(item) {
        item = item + '';
        return (item.indexOf('./')) === -1 && (item.indexOf('../')) === -1;
      }));
      if (n === count - 1) {
        return fin(_.unique(_.flatten(deps)));
      }
    });
  });
});

fin = function(deps) {
  var json;
  json = {
    name: _.last(__dirname.split('/')),
    dependencies: _.mapValues(_.invert(_.extend({}, deps)), function() {
      return 'x.x.x';
    })
  };
  return process.stdout.write(JSON.stringify(json));
};
